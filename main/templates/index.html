{% extends "base.html" %}
{% load static %}

{% block title %}
Travis Styer
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/home.css' %}" />
<link rel="stylesheet" href="{% static 'css/project.css' %}" />
{% endblock %}

{% block content %}

<header class="home-hero">
  <div class="home-hero__top">
    <h2>FRONTEND JAVASCRIPT DEVELOPER</h2>
    <h1>Travis Styer</h1>
    <h3>Click the tags to see my work</h3>
  </div>

  <div class="home-hero__bottom">
    <div class="tag-line">
      <p>
        I specialise in building accessible and engaging websites that meet brand
        requirements. Outside Code Institute studies, my free time is spent studying
        UX/UI design and copywriting. You can see my work by filtering through the
        tags below. And feel free to leave comments, too. Simply create an account,
        log in and you'll be able to post on any project.
      </p>
    </div>

    <div class="home-hero__image">
      <img
        src="{% static 'images/avataaars.png' %}"
        alt="Illustration of Travis Styer"
      />
    </div>
  </div>
</header>

<main>
  <section class="filters">
    <input
      type="text"
      id="name-search"
      placeholder="Search by project"
    />

    <div class="tags-list">
      {% for tag in tags %}
        <button
          class="tag"
          data-tag="{{ tag.name|lower|escape }}"
        >
          {{ tag.name }}
        </button>
      {% empty %}
        <p class="small">No tags yet.</p>
      {% endfor %}
    </div>
  </section>

  <section class="projects-list">
    {% for project in projects %}
      <div
        class="project-card"
        data-name="{{ project.title|lower|escape }}"
        data-tags="{% for tag in project.tags.all %}{{ tag.name|lower|escape }} {% endfor %}"
        data-project-id="{{ project.id }}"
      >
        <h2>
          <a
            href="javascript:void(0)"
            class="project-info-link"
            data-project-id="{{ project.id }}"
          >
            {{ project.title }}
          </a>
        </h2>

        <p>{{ project.description }}</p>

        <p>
          <strong>Tags:</strong>
          {% for tag in project.tags.all %}
            {{ tag.name }}{% if not forloop.last %}, {% endif %}
          {% endfor %}
        </p>

        <button class="comment-btn" type="button">
          Comments
        </button>
      </div>
    {% empty %}
      <p>No projects found.</p>
    {% endfor %}
  </section>

  <p id="temp-p">
    Select a tag or type in the search field to filter projects.
  </p>
</main>

{% endblock %}

{% block extra_modals %}

<div id="project-info-modal" class="project-info-modal">
  <div class="project-info-modal__backdrop"></div>

  <div class="project-info-modal__content">
    <button
      class="project-info-modal__close"
      type="button"
      aria-label="Close"
    ></button>

    <div id="project-info-modal-body">
      <h2 id="project-info-title"></h2>
      <p id="project-info-description"></p>
      <a
        id="project-info-github"
        href="#"
        target="_blank"
        rel="noopener"
      >
        View on GitHub
      </a>
    </div>
  </div>
</div>

{% endblock %}

{% block inline_scripts %}
<script>
  // DB-backed project data
  const projectsData = {
    {% for project in projects %}
      "{{ project.id }}": {
        title: "{{ project.title|escapejs }}",
        description: "{{ project.description|escapejs }}",
        github: "{% if project.github_url %}{{ project.github_url|escapejs }}{% elif project.link %}{{ project.link|escapejs }}{% else %}{% endif %}"
      }{% if not forloop.last %},{% endif %}
    {% endfor %}
  };

  const projectInfoModal = document.getElementById("project-info-modal");
  const projectInfoBackdrop = document.querySelector(".project-info-modal__backdrop");
  const projectInfoCloseBtn = document.querySelector(".project-info-modal__close");
  const projectInfoLinks = document.querySelectorAll(".project-info-link");

  function openProjectInfoModal(projectId) {
    const project = projectsData[projectId];
    if (!project) return;

    document.getElementById("project-info-title").textContent = project.title;
    document.getElementById("project-info-description").textContent = project.description;

    const githubLink = document.getElementById("project-info-github");
    if (project.github && project.github.trim() !== "") {
      githubLink.href = project.github;
      githubLink.style.display = "";
    } else {
      githubLink.style.display = "none";
    }

    projectInfoModal.style.display = "flex";
  }

  function closeProjectInfoModal() {
    projectInfoModal.style.display = "none";
  }

  projectInfoLinks.forEach((link) => {
    link.addEventListener("click", (e) => {
      e.preventDefault();
      openProjectInfoModal(link.dataset.projectId);
    });
  });

  projectInfoCloseBtn.addEventListener("click", closeProjectInfoModal);
  projectInfoBackdrop.addEventListener("click", closeProjectInfoModal);
</script>
{% endblock %}
